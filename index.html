<!DOCTYPE html>
<html>
<head>
  <title>Quáº£n lÃ½ Thiáº¿t bá»‹ Chiáº¿u sÃ¡ng</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
  <h2>ThÃªm thiáº¿t bá»‹</h2>
  <input id="maThietBi" placeholder="Nháº­p mÃ£ thiáº¿t bá»‹">
  <button onclick="themThietBi()">ThÃªm</button>

  <h2>Báº­t/Táº¯t thiáº¿t bá»‹</h2>
  <input id="maThietBiBatTat" placeholder="Nháº­p mÃ£ thiáº¿t bá»‹">
  <button onclick="batTatThietBi()">Báº­t/Táº¯t</button>

  <h2>Tráº¡ng thÃ¡i thiáº¿t bá»‹</h2>
  <input id="maThietBiTrangThai" placeholder="Nháº­p mÃ£ thiáº¿t bá»‹">
  <button onclick="layTrangThai()">Xem tráº¡ng thÃ¡i</button>
  <p id="ketQuaTrangThai"></p>

  <script>
    let web3;
    let contract;
    let userAccount;

    const contractAddress = "PASTE_CONTRACT_ADDRESS_HERE"; // Thay báº±ng Ä‘á»‹a chá»‰ há»£p Ä‘á»“ng
    const abi = []; // DÃ¡n ABI cá»§a Smart Contract táº¡i Ä‘Ã¢y

    window.addEventListener('load', async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
          await window.ethereum.enable();
          const accounts = await web3.eth.getAccounts();
          userAccount = accounts[0];
          contract = new web3.eth.Contract(abi, contractAddress);
          console.log("âœ… Káº¿t ná»‘i thÃ nh cÃ´ng vá»›i MetaMask!");
        } catch (error) {
          console.error("âŒ Lá»—i khi káº¿t ná»‘i MetaMask:", error);
        }
      } else {
        alert("ğŸ”´ Vui lÃ²ng cÃ i Ä‘áº·t MetaMask Ä‘á»ƒ tiáº¿p tá»¥c!");
      }
    });

    async function themThietBi() {
      const id = document.getElementById("maThietBi").value;
      if (!id) {
        alert("âŒ MÃ£ thiáº¿t bá»‹ khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!");
        return;
      }

      try {
        await contract.methods.themThietBi(id).send({ from: userAccount });
        alert("âœ… Thiáº¿t bá»‹ Ä‘Ã£ Ä‘Æ°á»£c thÃªm thÃ nh cÃ´ng!");
      } catch (error) {
        console.error("âŒ Lá»—i khi thÃªm thiáº¿t bá»‹:", error);
      }
    }

    async function batTatThietBi() {
      const id = document.getElementById("maThietBiBatTat").value;
      if (!id) {
        alert("âŒ MÃ£ thiáº¿t bá»‹ khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!");
        return;
      }

      try {
        await contract.methods.batTatThietBi(id).send({ from: userAccount });
        alert("âœ… ÄÃ£ thay Ä‘á»•i tráº¡ng thÃ¡i thiáº¿t bá»‹!");
      } catch (error) {
        console.error("âŒ Lá»—i khi báº­t/táº¯t thiáº¿t bá»‹:", error);
      }
    }

    async function layTrangThai() {
      const id = document.getElementById("maThietBiTrangThai").value;
      if (!id) {
        alert("âŒ MÃ£ thiáº¿t bá»‹ khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!");
        return;
      }

      try {
        const result = await contract.methods.layTrangThaiThietBi(id).call();
        document.getElementById("ketQuaTrangThai").innerText =
          `ğŸŸ¢ Tráº¡ng thÃ¡i: ${result[0] ? "Báº­t" : "Táº¯t"} | ğŸ•’ Tá»•ng thá»i gian sá»­ dá»¥ng: ${result[1]} giá»`;
      } catch (error) {
        console.error("âŒ Lá»—i khi láº¥y tráº¡ng thÃ¡i thiáº¿t bá»‹:", error);
      }
    }
  </script>
</body>
</html>
